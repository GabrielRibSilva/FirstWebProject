<h1 style="text-align: center; color: #2c3e50;">Cadastro de Pessoa</h1>

<div
  style="max-width: 600px; margin: 0 auto; padding: 20px; background: #f9f9f9; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
  <form [formGroup]="formulario">
    <div style="margin-bottom: 15px;">
      <label for="nome">Nome</label><br />
      <input id="nome" type="text" formControlName="nome" style="width: 100%; padding: 8px;"
        [ngStyle]="{'border-color': f['nome'].errors && f['nome'].touched ? 'red' : ''}"
        (keypress)="validarEntradaNome($event)" 
        (input)="validarColaNome($event)"
        (paste)="validarColaNome($event)"
        maxlength="100" />
      <div *ngIf="f['nome'].errors && f['nome'].touched" style="color: red; font-size: 12px; margin-top: 5px;">
        <div *ngIf="f['nome'].errors['required']">* O nome não pode ficar em branco</div>
        <div *ngIf="f['nome'].errors['minlength']">* O nome deve conter pelo menos 3 letras</div>
        <div *ngIf="f['nome'].errors['maxlength']">* O nome deve ter no máximo 100 caracteres</div>
        <div *ngIf="f['nome'].errors['pattern']">* O nome deve conter apenas letras, espaços, apóstrofos e hífens</div>
      </div>
    </div>

    <div style="margin-bottom: 15px;">
      <label for="cpf">CPF</label><br />
      <input id="cpf" type="text" formControlName="cpf" style="width: 100%; padding: 8px;"
        [ngStyle]="{'border-color': f['cpf'].errors && f['cpf'].touched ? 'red' : ''}"
        (keypress)="validarEntradaCPF($event)" 
        (input)="validarColaCPF($event)"
        (paste)="validarColaCPF($event)"
        placeholder="000.000.000-00" maxlength="14" />
      <div *ngIf="f['cpf'].errors && f['cpf'].touched" style="color: red; font-size: 12px; margin-top: 5px;">
        <div *ngIf="f['cpf'].errors['required']">* O CPF é um campo obrigatório</div>
        <div *ngIf="f['cpf'].errors['cpfTamanhoInvalido']">* O CPF deve ter 11 dígitos</div>
        <div *ngIf="f['cpf'].errors['cpfDigitosIguais']">* CPF inválido: todos os dígitos são iguais</div>
        <div *ngIf="f['cpf'].errors['cpfDigitoVerificador']">* O CPF informado não é válido. Verifique os dígitos e tente novamente</div>
        <div *ngIf="f['cpf'].errors['maxlength']">* O CPF deve ter no máximo 14 caracteres</div>
      </div>
    </div>

    <div style="margin-bottom: 15px;">
      <label for="email">Email</label><br />
      <input id="email" type="email" formControlName="email" style="width: 100%; padding: 8px;"
        [ngStyle]="{'border-color': f['email'].errors && f['email'].touched ? 'red' : ''}"
        (input)="validarColaEmail($event)"
        (paste)="validarColaEmail($event)"
        placeholder="exemplo&#64;email.com" maxlength="60" />
      <div *ngIf="f['email'].errors && f['email'].touched" style="color: red; font-size: 12px; margin-top: 5px;">
        <div *ngIf="f['email'].errors['required']">* O email não pode ficar em branco</div>
        <div *ngIf="f['email'].errors['emailFormatoInvalido']">* Formato de email inválido. Exemplo correto: usuario&#64;dominio.com ou usuario&#64;dominio.com.BR</div>
        <div *ngIf="f['email'].errors['emailCodigoPaisInvalido']">* Código de país inválido no email. Códigos permitidos: AP, AR, AT, AU, BA, BE, BG, BR, CA, CH, CN, CU, etc.</div>
        <div *ngIf="f['email'].errors['emailCodigoTamanhoInvalido']">* O código de país deve ter exatamente 2 letras</div>
        <div *ngIf="f['email'].errors['maxlength']">* O email não pode exceder 60 caracteres</div>
      </div>
    </div>

    <div style="margin-bottom: 15px;">
      <label for="telefone">Telefone</label><br />
      <input id="telefone" type="text" formControlName="telefone" style="width: 100%; padding: 8px;"
        [ngStyle]="{'border-color': f['telefone'].errors && f['telefone'].touched ? 'red' : ''}"
        (keypress)="validarEntradaTelefone($event)"
        (input)="validarColaTelefone($event)"
        (paste)="validarColaTelefone($event)"
        placeholder="(00) 00000-0000" maxlength="15" />
      <div *ngIf="f['telefone'].errors && f['telefone'].touched" style="color: red; font-size: 12px; margin-top: 5px;">
        <div *ngIf="f['telefone'].errors['required']">* O telefone é um campo obrigatório</div>
        <div *ngIf="f['telefone'].errors['telefoneTamanhoInvalido']">* O telefone deve ter 10 ou 11 dígitos</div>
        <div *ngIf="f['telefone'].errors['pattern']">* Formato de telefone inválido. Use apenas números, parênteses, espaços e hífens (10-15 caracteres)</div>
        <div *ngIf="f['telefone'].errors['maxlength']">* O telefone deve ter no máximo 15 caracteres</div>
      </div>
    </div>

    <div style="text-align: center;">
      <button type="button" (click)="salvar()"
        style="padding: 10px 20px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">
        Salvar
      </button>
    </div>
  </form>
</div>

<div style="max-width: 800px; margin: 30px auto;">
  <table border="1" style="width: 100%; border-collapse: collapse; background: white;">
    <thead style="background: #34495e; color: white;">
      <tr>
        <th style="padding: 10px;">Nome</th>
        <th style="padding: 10px;">CPF</th>
        <th style="padding: 10px;">Email</th>
        <th style="padding: 10px;">Telefone</th>
        <th style="padding: 10px;">Ações</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let pessoa of pessoas" style="text-align: center;">
        <td style="padding: 8px;">{{ pessoa.nome }}</td>
        <td style="padding: 8px;">{{ pessoa.cpf }}</td>
        <td style="padding: 8px;">{{ pessoa.email }}</td>
        <td style="padding: 8px;">{{ pessoa.telefone }}</td>
        <td style="padding: 8px;">
          <button (click)="carregarParaEdicao(pessoa)"
            style="background: #f39c12; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-right: 5px; cursor: pointer;">
            Alterar
          </button>
          <button (click)="excluir(pessoa.id)"
            style="background: #c0392b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
            Excluir
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pop-up de Edição -->
<div *ngIf="mostrarPopup" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(3px);">
  <div style="background: white; padding: 30px; border-radius: 15px; width: 550px; max-width: 95%; box-shadow: 0 5px 25px rgba(0,0,0,0.3); animation: fadeIn 0.3s ease-out;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f1f1f1; padding-bottom: 10px;">
      <h2 style="color: #2c3e50; margin: 0; font-size: 22px;">Editar Pessoa</h2>
      <button (click)="fecharPopup()" style="background: none; border: none; cursor: pointer; font-size: 22px; color: #7f8c8d;">×</button>
    </div>
    
    <div style="margin-bottom: 18px;">
      <label for="edit-nome" style="font-weight: 500; color: #34495e; display: block; margin-bottom: 5px;">Nome</label>
      <input id="edit-nome" type="text" [(ngModel)]="pessoaEmEdicao.nome" 
        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; transition: border-color 0.2s;"
        [ngStyle]="{'border-color': erroNome ? '#e74c3c' : '#ddd'}"
        (keypress)="validarNomePopup($event)"
        (input)="validarColaNomePopup($event); verificarErros()"
        (paste)="validarColaNomePopup($event)"
        maxlength="100" />
      <div *ngIf="erroNome" style="color: #e74c3c; font-size: 12px; margin-top: 5px;">
        <div *ngIf="erroNomeTipo === 'required'">* O nome não pode ficar em branco</div>
        <div *ngIf="erroNomeTipo === 'minlength'">* O nome deve conter pelo menos 3 letras</div>
        <div *ngIf="erroNomeTipo === 'maxlength'">* O nome deve ter no máximo 100 caracteres</div>
        <div *ngIf="erroNomeTipo === 'pattern'">* O nome deve conter apenas letras, espaços, apóstrofos e hífens</div>
      </div>
    </div>

    <div style="margin-bottom: 18px;">
      <label for="edit-cpf" style="font-weight: 500; color: #34495e; display: block; margin-bottom: 5px;">CPF</label>
      <input id="edit-cpf" type="text" [(ngModel)]="pessoaEmEdicao.cpf" 
        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; transition: border-color 0.2s;"
        [ngStyle]="{'border-color': erroCPF ? '#e74c3c' : '#ddd'}" 
        (keypress)="validarCPFPopup($event)"
        (input)="validarColaCPFPopup($event); verificarErros()"
        (paste)="validarColaCPFPopup($event)"
        maxlength="14" />
      <div *ngIf="erroCPF" style="color: #e74c3c; font-size: 12px; margin-top: 5px;">
        <div *ngIf="erroCPFTipo === 'required'">* O CPF é um campo obrigatório</div>
        <div *ngIf="erroCPFTipo === 'tamanho'">* O CPF deve ter 11 dígitos</div>
        <div *ngIf="erroCPFTipo === 'digitosIguais'">* CPF inválido: todos os dígitos são iguais</div>
        <div *ngIf="erroCPFTipo === 'digitoVerificador'">* O CPF informado não é válido. Verifique os dígitos e tente novamente</div>
      </div>
    </div>

    <div style="margin-bottom: 18px;">
      <label for="edit-email" style="font-weight: 500; color: #34495e; display: block; margin-bottom: 5px;">Email</label>
      <input id="edit-email" type="email" [(ngModel)]="pessoaEmEdicao.email" 
        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; transition: border-color 0.2s;"
        [ngStyle]="{'border-color': erroEmail ? '#e74c3c' : '#ddd'}"
        (input)="validarColaEmailPopup($event); verificarErros()"
        (paste)="validarColaEmailPopup($event)"
        maxlength="60" />
      <div *ngIf="erroEmail" style="color: #e74c3c; font-size: 12px; margin-top: 5px;">
        <div *ngIf="erroEmailTipo === 'required'">* O email não pode ficar em branco</div>
        <div *ngIf="erroEmailTipo === 'formato'">* Formato de email inválido. Exemplo correto: usuario&#64;dominio.com ou usuario&#64;dominio.com.BR</div>
        <div *ngIf="erroEmailTipo === 'codigopais'">* Código de país inválido no email. Códigos permitidos: AP, AR, AT, AU, BA, BE, BG, BR, CA, CH, etc.</div>
        <div *ngIf="erroEmailTipo === 'tamanhocodigopais'">* O código de país deve ter exatamente 2 letras</div>
        <div *ngIf="erroEmailTipo === 'maxlength'">* O email não pode exceder 60 caracteres</div>
      </div>
    </div>

    <div style="margin-bottom: 18px;">
      <label for="edit-telefone" style="font-weight: 500; color: #34495e; display: block; margin-bottom: 5px;">Telefone</label>
      <input id="edit-telefone" type="text" [(ngModel)]="pessoaEmEdicao.telefone" 
        style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ddd; transition: border-color 0.2s;"
        [ngStyle]="{'border-color': erroTelefone ? '#e74c3c' : '#ddd'}"
        (keypress)="validarTelefonePopup($event)"
        (input)="validarColaTelefonePopup($event); verificarErros()"
        (paste)="validarColaTelefonePopup($event)"
        maxlength="15" />
      <div *ngIf="erroTelefone" style="color: #e74c3c; font-size: 12px; margin-top: 5px;">
        <div *ngIf="erroTelefoneTipo === 'required'">* O telefone é um campo obrigatório</div>
        <div *ngIf="erroTelefoneTipo === 'tamanho'">* O telefone deve ter 10 ou 11 dígitos</div>
        <div *ngIf="erroTelefoneTipo === 'pattern'">* Formato de telefone inválido. Use apenas números, parênteses, espaços e hífens</div>
        <div *ngIf="erroTelefoneTipo === 'maxlength'">* O telefone deve ter no máximo 15 caracteres</div>
      </div>
    </div>

    <div style="display: flex; justify-content: flex-end; margin-top: 25px;">
      <button (click)="fecharPopup()" 
        style="background: #ecf0f1; color: #7f8c8d; border: none; padding: 12px 20px; border-radius: 6px; margin-right: 15px; cursor: pointer; font-weight: 500; transition: background 0.2s;">
        Cancelar
      </button>
      <button (click)="salvarEdicao()" 
        [disabled]="temErros"
        [ngStyle]="{'background': temErros ? '#95a5a6' : '#27ae60', 'cursor': temErros ? 'not-allowed' : 'pointer'}"
        style="color: white; border: none; padding: 12px 20px; border-radius: 6px; font-weight: 500; transition: background 0.2s;">
        Salvar Alterações
      </button>
    </div>
  </div>
</div>

<style>
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

input:focus {
  outline: none;
  border-color: #3498db !important;
  box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
}
</style>